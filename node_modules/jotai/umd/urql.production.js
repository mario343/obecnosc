!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@urql/core"),require("jotai"),require("wonka")):"function"==typeof define&&define.amd?define(["exports","@urql/core","jotai","wonka"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).jotaiUrql={},t.core,t.jotai,t.wonka)}(this,(function(t,r,n,e){"use strict";var o=function(){try{return process.env.JOTAI_URQL_DEFAULT_URL}catch(t){return}}()||"/graphql",u=n.atom(r.createClient({url:o}));function i(){return i=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t},i.apply(this,arguments)}t.atomWithMutation=function(t,r){void 0===r&&(r=function(t){return t(u)});var e=n.atom(new Promise((function(){})));return n.atom((function(t){return t(e)}),(function(n,o,u){o(e,new Promise((function(){})));var i=r(n),a=t(n);i.mutation(a,u.variables,u.context).toPromise().then((function(t){o(e,t),null==u.callback||u.callback(t)})).catch((function(){}))}))},t.atomWithQuery=function(t,r){void 0===r&&(r=function(t){return t(u)});var o=n.atom((function(){return{}})),a=function(t,r,o,u){var a=null,c=n.atom(new Promise((function(t){a=t})));t.resultAtom=c;var s=function(){throw new Error("setting result without mount")},l=function(r){if(c===t.resultAtom){if(!function(t){return"data"in t&&!t.error}(r))throw new Error("result does not have data");a?(a(r),a=null):s(r)}};return r.query(o.query,o.variables,i({},o.requestPolicy&&{requestPolicy:o.requestPolicy},o.context,u)).toPromise().then(l).catch((function(){})),c.onMount=function(t){s=t;var n=e.pipe(r.query(o.query,o.variables,i({},o.requestPolicy&&{requestPolicy:o.requestPolicy},o.context,u)),e.skip(1),e.subscribe(l));return function(){return n.unsubscribe()}},c},c=n.atom((function(n){var e=t(n);if(e.pause)return null;var u=r(n);return{resultAtom:a(n(o),u,e),client:u,args:e}})),s=n.atom(null);return n.atom((function(t){var r=t(c);if(!r)return null;var n=r.resultAtom,e=t(s);return e&&e.oldResultAtom===n&&(n=e.newResultAtom),t(n)}),(function(t,r,n){if("reexecute"===n.type){var e=t(c);if(!e)throw new Error("query is paused");var u=e.resultAtom,i=e.client,l=e.args;r(s,{oldResultAtom:u,newResultAtom:a(t(o),i,l,n.opts)})}}))},t.atomWithSubscription=function(t,r){void 0===r&&(r=function(t){return t(u)});var o=n.atom((function(o){var u=t(o);if(u.pause)return{args:u};var i=r(o),a=null,c=n.atom(new Promise((function(t){a=t}))),s=function(){throw new Error("setting result without mount")},l=function(t){if(!function(t){return"data"in t}(t))throw new Error("result does not have data");a?(a(t),a=null):s(t)},f=e.pipe(i.subscription(u.query,u.variables,u.context),e.subscribe(l)),m=setTimeout((function(){m=null,f.unsubscribe()}),1e3);return c.onMount=function(t){var r;return s=t,m?(clearTimeout(m),r=f):r=e.pipe(i.subscription(u.query,u.variables,u.context),e.subscribe(l)),function(){return r.unsubscribe()}},{resultAtom:c,args:u}}));return n.atom((function(t){var r=t(o).resultAtom;return r?t(r):null}))},t.clientAtom=u,Object.defineProperty(t,"__esModule",{value:!0})}));
